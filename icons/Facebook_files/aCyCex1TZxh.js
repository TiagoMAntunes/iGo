if (self.CavalryLogger) { CavalryLogger.start_js(["a+1Z7"]); }

__d("MessengerTabsThreadSearchStore",["cx","ImmutableObject","MercurySearchContextResults","MercurySearchSnippetResults","MercurySingletonProvider","MessengerState.bs","MessengerStore","MessengerThreadSearchActions","gkx","immutable"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=b("immutable").List;c=b("immutable").Record;var h=c({downExhausted:null,loading:!1,messages:null,results:a(),selectedIndex:0,threadID:null,upExhausted:null,mid:null});d=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this)||this;d.$MessengerTabsThreadSearchStore1={};d.$MessengerTabsThreadSearchStore3=c;d.$MessengerTabsThreadSearchStore2=new(b("MercurySearchSnippetResults"))(c);return d}c.get=function(){return i.get()};var d=c.prototype;d.getThreadState=function(a){a=this.$MessengerTabsThreadSearchStore1[a];return a?a:new h()};d.__onDispatch=function(a){__p&&__p();var c=this;if(!this.$MessengerTabsThreadSearchStore2)return;var d=a.threadID;if(!d)return;switch(a.type){case b("MessengerThreadSearchActions").Types.UPDATE_THREAD_STATE:var e=a.mid;if(!e){this.$MessengerTabsThreadSearchStore1[d]=new h();this.emitChange();return}var f=this.$MessengerTabsThreadSearchStore1[d];f||(f=new h());if(e!=f.mid){this.$MessengerTabsThreadSearchStore1[d]=f.merge({threadID:d,mid:e});b("MercurySearchContextResults").getSearchContext(this.$MessengerTabsThreadSearchStore4(d),d,function(a){return c.setMessagesForThread(a,d)});return}break;case b("MessengerThreadSearchActions").Types.GET_MORE_CONTEXT:if(!this.$MessengerTabsThreadSearchStore1[d])return;this.$MessengerTabsThreadSearchStore1[d]=this.$MessengerTabsThreadSearchStore1[d].set("loading",!0);b("MercurySearchContextResults").getMoreSearchContext(this.$MessengerTabsThreadSearchStore4(d),d,a.direction,function(a){return c.setMessagesForThread(a,d)});this.emitChange();break}};d.setMessagesForThread=function(a,c){__p&&__p();var d=this.$MessengerTabsThreadSearchStore1[c];d||(d=new h());if(a.down_exhausted){if(this.$MessengerTabsThreadSearchStore1[c].messages){var e=this.$MessengerTabsThreadSearchStore1[c].messages.map(function(a){return a.message_id}).toArray();b("MessengerState.bs").invalidateSearchedMessages(this.$MessengerTabsThreadSearchStore3,e)}this.$MessengerTabsThreadSearchStore1[c]=new h();this.emitChange();return}e=b("MessengerState.bs").getMessagesFromIDs(this.$MessengerTabsThreadSearchStore3,[].concat(a.up_message_ids,a.message_id,a.down_message_ids)).map(function(c){if(c&&c.message_id===a.message_id)if(!d.results.isEmpty()){var e=d.results.get(d.selectedIndex).toJS(),f=e.matched_keywords,g=c.body.indexOf(e.body);e=Object.keys(e.matched_keywords).map(function(a){return{offset:g+Number(a),length:f[a].length,entity:{url:""},className:"__in"}});return new(b("ImmutableObject"))(babelHelpers["extends"]({},c,{ranges:c.ranges?c.ranges.concat(e):e}))}else return new(b("ImmutableObject"))(babelHelpers["extends"]({},c,{isSelected:!0}));return new(b("ImmutableObject"))(babelHelpers["extends"]({},c))});this.$MessengerTabsThreadSearchStore1[c]=d.merge({downExhausted:a.down_exhausted,loading:!1,messages:e,upExhausted:a.up_exhausted});this.emitChange()};d.$MessengerTabsThreadSearchStore4=function(a){a=this.$MessengerTabsThreadSearchStore1[a];return!a?"":a.mid||a.results.getIn([a.selectedIndex,"message_id"])};return c}(b("MessengerStore"));var i=new(b("MercurySingletonProvider"))(d);e.exports=d}),null);
__d("XOfferController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/offer/detail/{offer_id}/",{offer_id:{type:"FBID",required:!0},referrer:{type:"Enum",enumType:1},__xts__:{type:"StringVector"},__tn__:{type:"String"}})}),null);